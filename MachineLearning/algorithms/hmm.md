# HMM (Hidden Markov Model) 隐马尔可夫模型

**生成模型的一般逻辑是：假设当前的观测到的东西是由某一个分布生成的。**



> * 生成模型
> * 由 隐藏 的马尔可夫链随机生成观测序列的过程
> * 关于时序的概率模型



## 三要素（元组）

一个三元组定义了 HMM，他们分别是：

* 初始概率分布
* 状态转移概率 $\mathcal A = [a_{ij}]\_{N*N}, a_{ij}=P(q_j|q_i)$ 
* 观测概率分布 $\mathcal B=[b_{ij}]\_{N*M}, b_{i,j}=P(v_j|q_i)$ 



$\mathcal Q$ 是所有可能状态的集合，$\mathcal V$ 是所有可能的观测的集合：
$$
\mathcal Q=\{ q_1, q_2, ..., q_N \}, \mathcal V = \{ v_1,v_2, ..., v_M \}
$$
其中， N 是可能的状态数，M是可能的观测数。

$\mathcal I$ 是长度为 T 的状态序列，$\mathcal O$ 是长度为 T 的观测序列。



## 如何计算观测序列概率

> 前向后向算法

如何计算$ P(\mathcal O|\lambda)$$
$$
\begin{aligned}
 P(\mathcal O|\lambda) &= \sum_I P(\mathcal O, \mathcal I|\lambda) \\
 &=\sum_I P(\mathcal I |\lambda)P(\mathcal O|\mathcal I,\lambda) \\
 &= \sum_{i_1,i_2,i_3,...,i_T} \pi_{i1}b_{i1}(o_1)a_{i1,i2}b_{i2}(o_2)...a_{i_{T-1}}b_{i_T}(o_T)
\end{aligned}
$$
如果暴力求解的话，发现算法的复杂度是 $O(TN^T)$,用计算机很难求解。

**当然这个公式有可优化空间：如果仅仅只是 $i_t$ 变化了话，那么只需要求变化部分的概率，其它部分就没必要重新求。**



### 前向算法

**前向概率**

> 给定隐马尔可夫模型 $\lambda$ ，定义到时刻 $t$ ， 部分观测序列为 $o_1,o_2,..., o_t$, 且$t$时刻 状态为 $q_i$ 的概率为前向概率。

$$
\alpha_t(i) = P(o_1, o_2, ..., o_t, i_t=q_t|\lambda)
$$

算法：

1. 初始化 ： $\alpha_1(i)=\pi_ib_i(o_1), i=1,2,3,...,N$
2. 递推计算： $\alpha_{t+1}(i) = \Biggr[\sum_{j=1}^N\alpha_t(j)a_{ji}\Biggr]b_i(o_{t+1}), i=1,2,3,...,N$ 
3. 当 $t=T$ 终止计算。

这样，计算复杂度就变成了 $O(N^2T)$



前向算法的数学表达是这样的,从内往外求：
$$
\sum_{i_T}...\sum_{i_2}\Biggr(b_{i_2}(o_2)\sum_{i_1}\Bigr(\pi_{i_1}b_{i_1}(o_1)a_{i_1,i_2}\Bigr) a_{i_2,i_3}\Biggr)
$$






### 后向算法

既然前向可行，那么后向是不是也可行呢？



**后向概率**

> 给定隐马尔可夫模型 $\lambda$ ，定义到时刻 $t$ ， 从$t+1$ 到 $T$ 的部分观测序列为 $o_{t+1},o_{t+2},..., o_T$, 且$t$时刻 状态为 $q_i$ 的概率 为 后向概率。

$$
\beta_t(i) =P(o_{t+1},o_{t+2},...,o_T|i_t=q_i, \lambda)
$$

算法：

1. 初始化：$\beta_T(i)=1, i=1,2,...,N$， 终止状态可以看作，无限向自身循环的状态。
2. 递归计算（t下降）： $\beta_t(i) = \sum_{j=1}^Na_{ij}b_j(o_{t+1})\beta_{t+1}(j), i=1,2,3,...,N$
3. $t=1$ 时终止

这个算法的复杂度也是，$O(N^2T)$

**从后往前算，从后面没有依赖的部分开始**

后向算法的数学表示为：
$$
\sum_{i_1}...\sum_{i_T}a_{i_{T-1},i_T}b_{i_T}(o_T)
$$


## 学习算法

EM



## 预测算法

即，找最优路径。已知观测序列，计算概率最高的**状态序列**。 使用veterbi算法

已知 马尔可夫模型 $\lambda$ 和观测序列 $\mathcal O$ ，求在时刻 $t$ 处于状态 $q_i$ 的概率。



